<html>

<head>
    <style>
        body {
            background-color: #1b2240;
        }
        .popup {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .popup-content {
            font-family: Helvetica, sans-serif;
            font-size: 13px;
            background-color: rgba(200, 200, 200, 0.8);
            margin: 4px;
            padding: 4px;
            border: 1px solid #888;
            max-width: 400px;
            max-height: 400px;
            width: auto;
            overflow: auto;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
            border-radius: 10px;
            position: absolute;
        }
    </style>
    <script src="sample-data.js"></script>
    <script src="convert.js"></script>
    <script src="graph.js"></script>

</head>

<body>
    <div id="mynetwork"></div>
    <div id="popup" class="popup">
        <div class="popup-content">
            <div id="popup-text">Your dynamic text goes here...</div>
        </div>
    </div>    

    <script type="text/javascript" src="lib/vis-network.min.js"></script>
    <!--
  Including other packages like Vis Timeline or Vis Graph3D here won't work.
  You need the peer build to do that.
-->

    <script type="text/javascript">

        // create an array with nodes
        var nodes = new vis.DataSet([
            { id: 1, label: "Node 1" },
            { id: 2, label: "Node 2" },
            { id: 3, label: "Node 3" },
            { id: 4, label: "Node 4" },
            { id: 5, label: "Node 5" }
        ]);

        // create an array with edges
        var edges = new vis.DataSet([
            { from: 1, to: 3, label: "inBoundary" },
            { from: 1, to: 2 },
            { from: 2, to: 4 },
            { from: 2, to: 5 },
            { from: 5, to: 2 },
            { from: 3, to: 3 }
        ]);

        // create a network
        var container = document.getElementById("mynetwork");
        var options = {
            edges: {
                arrows: {
                    to: {
                        enabled: true,
                        scaleFactor: 0.6,
                        type: 'arrow'
                    }
                },
                font: {
                    color: 'white',
                    strokeWidth: 0,
                    size: 11
                }
            },
            nodes: {
                color: '#2070cb',
                fixed: false,
                size: 20,
                font: '12px Helvetica white',
                scaling: {
                    label: false
                },
                shadow: true,
                shape: 'dot'
            },
            physics: {
                enabled: true            
            },
            manipulation: {
                enabled: false
            }
        }
        var network = new vis.Network(container, {}, options);
        network.on('click', function (properties) {

            var ids = properties.nodes;
            let activeGraph = network["activeGraph"]            
            var clickedNodes = activeGraph.nodes.get(ids);
            popup = document.getElementById('popup')
            popupContent = document.getElementById('popup-text')
            if (clickedNodes.length != 1) {
                popup.style.display = 'none';
                return
            }
            clickedNode = clickedNodes[0]
            var text = ""
            for (const key in clickedNode) {
                if (clickedNode.hasOwnProperty(key)) {
                    const element = clickedNode[key];
                    text += `<span><b>${key}:</b> ${element}</span><br>`
                }
            }
            popupContent.innerHTML = text;
            var popupBox = document.querySelector('.popup-content');
            popupBox.style.top =  properties.pointer.DOM.y + 'px';
            popupBox.style.left = (properties.pointer.DOM.x+30) + 'px';
            popup.style.display = 'block';
        });

        window.onclick = function(event) {
            if (event.target == document.getElementById('popup')) {
                document.getElementById('popup').style.display = 'none';
            }
        };        

        setTimeout(function () {
            nodes = {}
            edges = []
            // check for data from the url parameters
            var params = new URLSearchParams(window.location.search);
            var passedData = params.get('data');
            if (passedData) {
                data = JSON.parse(atob(passedData));
            }
            extractDict(nodes, edges, data);
            if (edges.length > 0) {
                result = convertToVisualizationFormat(nodes, edges);
                nodes = new vis.DataSet(result.nodes)
                edges = new vis.DataSet(result.edges)
                network.setData({
                    nodes: nodes,
                    edges: edges
                })
                network["activeGraph"] = {
                    nodes: nodes,
                    edges: edges                
                }
            }
        }, 1000);

    </script>
</body>

</html>